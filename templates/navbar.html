{% load static %}
{% load transaction_tags %}
<!-- 네비게이션바 -->
<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
    <a class="navbar-brand" href="{% url 'community:index' %}" style="color: blue;"><img src="{% static 'synopex.png' %}" alt="profile" style="width:100px; vertical-align: middle;"></a>
    <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" arai-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse flex-grow-0" id="navbarNav">
        <ul class="navbar-nav">
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'free_board' %}">자유게시판</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'question_and_answer' %}">신장투석 Q&A</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'battle_board' %}">투병 이야기</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'study_board' %}">스터디 게시판</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'healthcare_information' %}">헬스케어 종합정보</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'guidelines' %}">공지사항</a></li>
            <li><a class="nav-link" href="{% url 'community:board_filtered' 'synopex_story' %}">시노펙스 이야기</a></li>
            {% if user.is_authenticated %}
            <li class="nav-item">
                <a class="nav-link" href="{% url 'common:account_page' %}">
                    <img src="{% static 'profile.png' %}" alt="profile" style="width:20px; vertical-align: middle;">{{ user.username }}
                </a>
            </li>
            {% endif %}
            <li><a class="nav-link" href="{% url 'common:settings_base' %}"><img src="{% static 'settings.png' %}" alt="settings" style="width:20px; vertical-align: middle;">설정</a></li>
            <li><a class="nav-link" href="{% url 'common:user_ranking' %}"><img src="{% static 'rankings.png' %}" alt="rankings" style="width:20px; vertical-align: middle;">랭킹</a></li>
            <li><a class="nav-link" href="{% url 'common:attendance' %}"><img src="{% static 'attendance.png' %}" alt="attendance" style="width:20px; vertical-align: middle;">출석체크</a></li>
            <li><a class="nav-link" href="{% url 'common:referral' %}"><img src="{% static 'referral.png' %}" alt="referral" style="width:20px; vertical-align: middle;">친구추천</a></li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" onclick="toggleDropdown(event)" aria-haspopup="true"><img src="{% static 'notifications.png' %}" alt="notifications" style="width:20px; vertical-align: middle;">알림</a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                    {% get_last_transactions as last_transactions %}
                    {% for t in last_transactions %}
                    <a class="dropdown-item" href="{% url 'common:transaction_detail' t.id %}">
                        <strong>{{ t.timestamp|date:"SHORT_DATETIME_FORMAT" }}</strong>:
                        {% if t.points %}{{ t.points }} 포인트{% endif %}
                        - {{ t.reason }}
                    </a>
                    {% empty %}
                    <a class="dropdown-item" href="#">최근 활동이 없습니다</a>
                    {% endfor %}
                </div>
            </li>
            <li class="nav-item">
                {% if user.is_authenticated %}
                <a class="nav-link" href="{% url 'common:logout' %}">
                    <img src="{% static 'logout.png' %}" alt="logout" style="width:20px; vertical-align: middle;">로그아웃
                </a>
                {% else %}
                <a class="nav-link" href="{% url 'common:login' %}">
                    <img src="{% static 'login.png' %}" alt="login" style="width:20px; vertical-align: middle;">로그인
                </a>
                {% endif %}
            </li>
        </ul>
    </div>
</nav>
<script>
// This function toggles the dropdown.
function toggleDropdown(event) {
    // Prevent the default anchor behavior
    event.preventDefault();
    // Get the dropdown menu of the clicked dropdown link
    var dropdownContent = event.currentTarget.nextElementSibling;
    // Toggle the display property between 'block' and 'none'
    dropdownContent.style.display = dropdownContent.style.display === 'block' ? 'none' : 'block';
}

// Optional: Close the dropdown if the user clicks outside of it
window.onclick = function(event) {
    if (!event.target.matches('.dropdown-toggle')) {
        var dropdowns = document.getElementsByClassName("dropdown-menu");
        for (var i = 0; i < dropdowns.length; i++) {
            var openDropdown = dropdowns[i];
            if (openDropdown.style.display === 'block') {
                openDropdown.style.display = 'none';
            }
        }
    }
}
</script>