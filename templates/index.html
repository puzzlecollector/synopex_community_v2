{% extends "base.html" %}
{% load static %}
{% load aiphabtc_filter %}
{% load humanize %}

{% block head %}
{{ block.super }}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<style>
    a {
        text-decoration: none; /* Remove underline */
        color: #007bff; /* Bootstrap default blue color for links */
    }
    .news-table {
        width: 100%;
        border-collapse: collapse;
    }
    .news-row {
        display: table-row;
    }
    .news-cell {
        display: table-cell;
        padding: 10px;
        border-bottom: 1px solid #ddd;
        position: relative; /* for tooltip positioning */
        text-align: center; /* Center text within the cell */
    }
    .title-cell {
        font-weight: bold;
        color: #333;
        cursor: help; /* indicates that a tooltip is available */
    }
    .datetime-cell {
        color: #666;
        font-size: 0.9em;
    }
    /* Tooltip styling */
    .title-cell:hover::after {
        content: attr(data-tooltip);
        position: absolute;
        left: 50%; /* Start from the middle of the cell */
        transform: translateX(-50%); /* Center the tooltip */
        bottom: 100%; /* Position above the title */
        margin-bottom: 10px; /* Lift the tooltip up */
        background-color: #333;
        color: white;
        padding: 10px 15px;
        border-radius: 6px;
        font-size: 0.9em;
        z-index: 10;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        max-width: 400px;
        white-space: normal;
        text-align: left;
        overflow-y: auto;
        transition: opacity 0.3s ease, visibility 0.3s ease;
        opacity: 0;
        visibility: hidden;
    }
    .title-cell:hover::after {
        opacity: 1;
        visibility: visible;
    }
    .sentiment-scores {
        margin: 20px 0;
    }

    .sentiment-score {
        background-color: #f2f2f2;
        border-radius: 5px;
        overflow: hidden;
        position: relative;
        margin-bottom: 10px;
    }

    .sentiment-bar {
        height: 20px;
        background-color: #4caf50;
        transition: width 0.3s ease;
    }

    .sentiment-text {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        color: white;
        font-weight: bold;
    }

    .voting-container {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        height: 300px; /* Adjust based on your needs */
    }

    .voting-container {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0,0,0,.1);
        margin-top: 20px;
    }

    .voting-container form {
        width: 100%;
    }

    .voting-container .form-check {
        margin: 10px 0;
    }

    .voting-container .form-check-input {
        cursor: pointer;
    }

    .voting-container .form-check-label {
        cursor: pointer;
        font-weight: 500;
    }

    .voting-container button[type="submit"] {
        width: 100%;
        margin-top: 20px;
    }

    .tradingview-widgets {
        display: flex;
        justify-content: space-between;
    }

    .tradingview-widget-container {
        flex: 1; /* Each container takes equal width */
        margin: 0 10px; /* Add some space between the widgets */
        height: 350px;
    }

    .investment-calendar-container {
        text-align: center;
        margin: 20px auto;
        max-width: 650px; /* Adjust based on your layout's max width */
    }

    .investment-calendar-container iframe {
        width: 100%;
        border: none; /* Remove border */
        margin-bottom: 10px; /* Space between iframe and attribution */
    }

    .poweredBy {
        font-size: 0.9rem;
        color: #666;
        text-align: center;
        margin-top: 10px;
    }

    .advertisement-container {
        text-align: center; /* Center the advertisement */
        margin: 20px 0; /* Add some space around the ad */
        box-shadow: 0 4px 8px rgba(0,0,0,0.1); /* Optional: Adds a subtle shadow around the ad for depth */
        border-radius: 8px; /* Optional: Rounds the corners of the ad container */
        overflow: hidden; /* Ensures the border-radius clips the image if needed */
    }

    .advertisement-image {
        width: 100%; /* Ensures the image fills the container */
        transition: transform 0.3s ease; /* Smoothly scales the image on hover */
    }

    .advertisement-container:hover .advertisement-image {
        transform: scale(1.05); /* Slightly enlarges the image on hover for a subtle interactive effect */
    }

    .ad-label {
        display: block;
        text-align: center;
        margin-bottom: 8px;
        font-size: 0.8rem;
        color: #666;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .footer {
        text-align: center; /* Center-align text */
        padding: 20px; /* Add some padding */
        background-color: #f2f2f2; /* Light grey background */
        color: #333; /* Darker text color for contrast */
        font-size: 0.9rem; /* Adjust the font size */
        border-top: 1px solid #ddd; /* Add a top border line */
        margin-top: 20px; /* Add some space above the footer */
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-5">
    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }} mt-4" role="alert">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}
    <div class="row">
        <div class="col-lg-6">
            <h3>ë¹„íŠ¸ì½”ì¸ ì‹œí™© ëŒ€ì‹œë³´ë“œ</h3>
            <hr>
            <!-- Dashboard content here -->
            <div class="btn-group mb-3 d-inline-block" role="group" aria-label="Platform Toggle">
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <a href="https://upbit.com/exchange?code=CRIX.UPBIT.KRW-BTC"><img src="{% static 'upbit.png' %}" alt="settings" style="height:20px; margin-right: 5px;">UPbit</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <a href="https://www.bybit.com/en/"><img src="{% static 'bybit.png' %}" alt="settings" style="height:20px; margin-right: 5px;">Bybit</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <a href="https://www.okx.com/join/36629823?gad_source=1&gclid=CjwKCAiAloavBhBOEiwAbtAJOyJGUidiYHP3emtf_Xz4vot1pz6rxj_NTJhrLR6kU2-Ftpo08BysNBoCO_MQAvD_BwE"><img src="{% static 'okx.png' %}" alt="settings" style="height:20px; margin-right: 5px;">OKX</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <a href="https://www.mexc.com/ko-KR"><img src="{% static 'mexc.png' %}" alt="settings" style="height:20px; margin-right: 5px;">MEXC</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <a href="https://www.pionex.com/en/"><img src="{% static 'pionex.png' %}" alt="settings" style="height:20px; margin-right: 5px;">Pionex</a>
                </button>
            </div>
            <br>
            <!-- TradingView Widget -->
            <div class="tradingview-widget-container">
                  <div class="tradingview-widget-container__widget" style="height:400px;width:100%">
                      <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                          {
                              "autosize": false,
                              "symbol": "UPBIT:BTCKRW",
                              "interval": "D",
                              "timezone": "Etc/UTC",
                              "theme": "light",
                              "style": "1",
                              "locale": "en",
                              "toolbar_bg": "#f1f3f6",
                              "enable_publishing": false,
                              "allow_symbol_change": true,
                              "studies": [
                                "STD;RSI"
                              ],
                              "container_id": "tradingview_3e3e3"
                          }
                      </script>
                  </div>
            </div>
            <br><br>
            <div style="text-align: left; margin-top: 10px; margin-botton: 10px;">
                <button id="fetchTechnicalAIResponse" class="btn btn-primary">AI ì¼ë´‰ ì¶”ì„¸ ë¶„ì„ ë³´ê¸°</button>
                <div id="TechnicalLoading" style="display:none;">AIê°€ ë¶„ì„ì¤‘... ì‹œê°„ì´ ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</div>
            </div>
            <!-- GPT ì¼ë´‰ ì¶”ì„¸ ë¶„ì„ -->
            <p id="TechnicalAIResponse">{{ technical_chat_message }}</p>
            <hr style="height: 3px; background-color: green;">
            <p>
                <a href="https://www.coinness.com" target="_blank" style="text-decoration: none; color: inherit;">
                    <img src="{% static 'coinness.png' %}" alt="Coinness Icon" style="vertical-align: middle; margin-right: 5px; height: 30px;">
                </a>
                <strong>ì½”ì¸ë‹ˆìŠ¤ ìµœì‹  ì†ë³´</strong>
                <div class="d-flex justify-content-center">
                    <div class="news-table w-100">
                        <div class="loading-indicator" style="display: none; text-align: center;">ìµœì‹  ì†ë³´ë¥¼ ì½ì–´ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤... ì¡°ê¸ˆë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”!</div>
                        {% for item in scraped_data %}
                            <div class="news-row">
                                <div class="news-cell title-cell" data-tooltip="{{ item.contents }}">
                                    <span class="news-title">{{ item.titles }}</span>
                                </div>
                                <div class="news-cell datetime-cell">
                                    <span class="news-datetime">{{ item.datetimes|date:"Y-m-d H:i" }}</span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <small>ë” ë‹¤ì–‘í•œ ë¯¸ë””ì–´ ì†ŒìŠ¤ì—ì„œ ìµœì‹  ì½”ì¸ ì‹œì¥ ë‰´ìŠ¤ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!</small>
                <div class="btn-group mb-3 d-inline-block" role="group" aria-label="Platform Toggle">
                    <button type="button" class="btn btn-outline-secondary btn-sm">
                        <a href="https://www.tokenpost.kr/"><img src="{% static 'tokenpost.png' %}" alt="settings" style="height:30px; margin-right: 5px;">í† í°í¬ìŠ¤íŠ¸</a>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm">
                        <a href="https://www.blockmedia.co.kr/"><img src="{% static 'blockmedia.png' %}" alt="settings" style="height:30px; margin-right: 5px;">ë¸”ë¡ë¯¸ë””ì–´</a>
                    </button>
                    <button type="button" class="btn btn-outline-secondary btn-sm">
                        <a href="https://bloomingbit.io/?tab=real"><img src="{% static 'bloomingbit.png' %}" alt="settings" style="height:30px; margin-right: 5px;">ë¸”ë£¨ë°ë¹„íŠ¸</a>
                    </button>
                </div>
                <p><strong> ë”¥ëŸ¬ë‹ ì–¸ì–´ëª¨ë¸ ë¹„íŠ¸ì½”ì¸ ê°ì„± ì ìˆ˜ </strong></p>
                <small>ìµœê·¼ ì½”ì¸ë‹ˆìŠ¤ ì†ë³´ë“¤ì´ ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì— ì–¼ë§Œí¼ í˜¸ì¬, ì•…ì¬, ì¤‘ë¦½ì„±ì„ ë„ê³  ìˆëŠ”ì§€ CryptoDeBERTa ì–¸ì–´ëª¨ë¸ì´ ë¶„ì„í•œ ê²°ê³¼ì…ë‹ˆë‹¤. ì•ŒíŒŒë¹„íŠ¸ ì¸ê³µì§€ëŠ¥ ì—°êµ¬íŒ€ì´ ê°œë°œí•œ ê°ì„±ë¶„ë¥˜ ì–¸ì–´ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ìˆ˜ì¹˜ê°€ ê³„ì‚°ë˜ì—ˆìŠµë‹ˆë‹¤.</small>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                        <a href="https://huggingface.co/LDKSolutions/KR-cryptodeberta-v2-base"><img src="{% static 'huggingface.png' %}" alt="settings" style="height:40px; margin-right: 5px;">ì•ŒíŒŒë¹„íŠ¸ í¬ë¦½í†  ì–¸ì–´ëª¨ë¸</a>
                </button>
                <div class="sentiment-scores">
                    {% for score in avg_sentiment_scores_percentage %}
                        <div class="sentiment-score">
                            <span class="sentiment-label">{{ sentiment_labels|get_item:forloop.counter0 }}:</span>
                            <div class="sentiment-bar" style="width: {{ score }}%;"></div>
                            <span class="sentiment-text" style="color: black;">{{ score|floatformat:2 }}%</span>
                        </div>
                    {% endfor %}
                </div>
            </p>
            <hr style="height: 3px; background-color: green;">
            <p>
                <strong>í¬ë¦½í†  ê³µí¬ íƒìš• ì§€ìˆ˜</strong>
                <span class="tooltip-question-mark" data-toggle="tooltip" data-html="true" title="í¬ë¦½í†  ê³µí¬ì™€ íƒìš• ì§€ìˆ˜ëŠ” íˆ¬ììë“¤ì˜ ì‹œì¥ì— ëŒ€í•œ ê°ì •ì„ ë‚˜íƒ€ë‚´ëŠ” ì§€í‘œ ì¤‘ í•˜ë‚˜ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ì§€ìˆ˜ëŠ” 0ì—ì„œ 100 ì‚¬ì´ì˜ ê°’ì„ ê°€ì§€ë©°, 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ììë“¤ì´ ë‘ë ¤ì›€ì„ ëŠë¼ê³  ìˆìŒì„, 100ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íƒìš•ì ì„ì„ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤. ì´ ì§€ìˆ˜ëŠ” ì£¼ë¡œ ì‹œì¥ì˜ ê·¹ë‹¨ì ì¸ ê°ì • ìƒíƒœë¥¼ í¬ì°©í•´ ë°˜ëŒ€ ë°©í–¥ìœ¼ë¡œì˜ ë³€í™”ë¥¼ ì˜ˆì¸¡í•˜ëŠ”ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì§€ìˆ˜ê°€ íƒìš•ìœ¼ë¡œ ì˜®ê²¨ê°€ë©´ ë¹„íŠ¸ì½”ì¸ ê°€ê²©ì´ ì˜¤ë¥¼ ê°€ëŠ¥ì„±ì´ ìˆì§€ë§Œ, ì´ëŠ” ë˜í•œ ê°€ê²©ì´ ê³¼ì—´ë˜ì–´ ì¡°ì •ì„ ë°›ì„ ìˆ˜ ìˆëŠ” ì‹œì ì— ì ‘ì–´ë“¤ ìˆ˜ ìˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.">[?]</span>
                <p>ë¹„íŠ¸ì½”ì¸ ë° ê¸°íƒ€ ëŒ€í˜• ì•”í˜¸í™”íë¥¼ ìœ„í•œ ìµœê·¼ 7ì¼ë™ì•ˆì˜ ê³µí¬ íƒìš• ì§€ìˆ˜ì…ë‹ˆë‹¤ <a href="https://alternative.me/crypto/fear-and-greed-index/">[ì°¸ê³ ]</a></p>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Value</th>
                            <th>Value Classification</th>
                        </tr>
                    </thead>
                    <tbody>
                    {% for row in data_fng %}
                        <tr>
                            <td>{{ row.timestamp }}</td>
                            <td>{{ row.value }}</td>
                            <td>{{ row.value_classification }}</td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </p>
            <hr style="height: 3px; background-color: green;">
            <p>
                <strong>ê¸€ë¡œë²Œ í¬ë¦½í†  ì‹œì¥ ì •ë³´</strong>
                <p>ì•”í˜¸í™”í ì‹œì¥ì˜ ì „ë°˜ì ì¸ ì •ë³´ì…ë‹ˆë‹¤ <a href="https://www.coinlore.com/ko/cryptocurrency-data-api">[ì°¸ê³ ]</a></p>
                <table class="table">
                    {% for row in data_global %}
                        <tr>
                            <th>ì½”ì¸ ìˆ˜</th>
                            <td>{{ row.coins_count|intcomma }}</td>
                        </tr>
                        <tr>
                            <th>í™œì„± ì‹œì¥</th>
                            <td>{{ row.active_markets|intcomma }}</td>
                        </tr>
                        <tr>
                            <th>ì‹œê°€ ì´ì•¡ ($)</th>
                            <td>{{ row.total_mcap |floatformat:2 |intcomma }}</td>
                        </tr>
                        <tr>
                            <th>ì´ ê±°ë˜ëŸ‰ ($)</th>
                            <td>{{ row.total_volume |floatformat:2 |intcomma }}</td>
                        </tr>
                        <tr>
                            <th>ì‹œê°€ ì´ì•¡ ë³€í™” (%)</th>
                            <td class="{% if row.mcap_change|to_float >= 0 %}text-success{% else %}text-danger{% endif %}">
                                {% if row.mcap_change|to_float >= 0 %}+{% endif %}{{ row.mcap_change|floatformat:2 }}
                            </td>
                        </tr>
                        <tr>
                            <th>ê±°ë˜ëŸ‰ ë³€í™” (%)</th>
                            <td class="{% if row.volume_change|to_float >= 0 %}text-success{% else %}text-danger{% endif %}">
                                {% if row.volume_change|to_float >= 0 %}+{% endif %}{{ row.volume_change|floatformat:2 }}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                <div class="tradingview-widgets">
                    <div class="tradingview-widget-container">
                        <h5>BTC ë„ë¯¸ë„ŒìŠ¤</h5>
                        <!-- TradingView Widget BEGIN -->
                        <div class="tradingview-widget-container" style="height:100%;width:100%">
                              <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                              <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
                              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                                  {
                                      "autosize": true,
                                      "symbol": "CRYPTOCAP:BTC.D",
                                      "interval": "D",
                                      "timezone": "Etc/UTC",
                                      "theme": "light",
                                      "style": "1",
                                      "locale": "en",
                                      "enable_publishing": false,
                                      "allow_symbol_change": true,
                                      "calendar": false,
                                      "support_host": "https://www.tradingview.com"
                                  }
                              </script>
                        </div>
                        <!-- TradingView Widget END -->
                    </div>
                    <div class="tradingview-widget-container">
                        <h5>ETH ë„ë¯¸ë„ŒìŠ¤</h5>
                        <!-- TradingView Widget BEGIN -->
                        <div class="tradingview-widget-container" style="height:100%;width:100%">
                              <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
                              <div class="tradingview-widget-copyright"><a href="https://www.tradingview.com/" rel="noopener nofollow" target="_blank"><span class="blue-text">Track all markets on TradingView</span></a></div>
                              <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
                                  {
                                      "autosize": true,
                                      "symbol": "CRYPTOCAP:ETH.D",
                                      "interval": "D",
                                      "timezone": "Etc/UTC",
                                      "theme": "light",
                                      "style": "1",
                                      "locale": "en",
                                      "enable_publishing": false,
                                      "allow_symbol_change": true,
                                      "calendar": false,
                                      "support_host": "https://www.tradingview.com"
                                  }
                              </script>
                        </div>
                        <!-- TradingView Widget END -->
                    </div>
                </div>
                <br><br>
                <div>
                    <strong>ì‹œì¥ ìƒê´€ê´€ê³„ ë¶„ì„</strong>
                    <p>ìµœê·¼ 30ì¼ê°„ BTC-KRWì™€ NAS100ì˜ ê°€ê²© ë³€ë™ ìƒê´€ê´€ê³„:</p>
                    <ul>
                        <li><strong>í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜ (Pearson):</strong> {{ pearson|floatformat:2 }}</li>
                        <li><strong>ìŠ¤í”¼ì–´ë§Œ ìƒê´€ê³„ìˆ˜ (Spearman):</strong> {{ spearman|floatformat:2 }}</li>
                        <li><strong>ì¼„ë‹¬ ìƒê´€ê³„ìˆ˜ (Kendall's Tau):</strong> {{ kendall|floatformat:2 }}</li>
                    </ul>
                    <p>ê°’ì´ 1ì´ë‚˜ -1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ê°•í•œ ì–‘ ë˜ëŠ” ìŒì˜ ìƒê´€ê´€ê³„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤. ìƒê´€ê³„ìˆ˜ ê°’ì´ -100ì¸ ê²½ìš° ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ë¬¸ì œê°€ ë°œìƒí–ˆìŒì„ ì˜ë¯¸í•©ë‹ˆë‹¤.</p>
                </div>
            </p>
            <hr style="height: 3px; background-color: green;">
            <p>
                <strong>ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ ì •ë³´</strong>
                <span class="tooltip-question-mark" data-toggle="tooltip" data-html="true" title="ê¹€ì¹˜ í”„ë¦¬ë¯¸ì—„ì´ë€ ìš©ì–´ëŠ” í•œêµ­ì˜ ì•”í˜¸í™”í ê°€ê²©ì´ í•´ì™¸ ê±°ë˜ì†Œì˜ ê°€ê²©ë³´ë‹¤ ë†’ì„ ë•Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ê¹€í”„ê°€ ë†’ë‹¤ëŠ” ê²ƒì€ í•´ì™¸ ê±°ë˜ì†Œì—ì„œ ìƒì¥ëœ ì½”ì¸ì˜ ê°€ê²©ì´ í•œêµ­ ë‚´ì—ì„œ ê±°ë˜ë˜ëŠ” ê°€ê²©ë³´ë‹¤ ìƒëŒ€ì ìœ¼ë¡œ ì €ë ´í•˜ë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤.">[?]</span>
                <p>ì½”ì¸ë² ì´ìŠ¤ì™€ ì—…ë¹„íŠ¸ì—ì„œ ê°€ì ¸ì˜¨ BTC ê°€ê²© ì •ë³´ë¡œ ê³„ì‚°ëœ ìˆ˜ì¹˜ì…ë‹ˆë‹¤ (ì½”ì¸ë² ì´ìŠ¤/ì—…ë¹„íŠ¸ í”„ë¦¬ë¯¸ì—„)</p>
                <table class="table">
                    <tr>
                        <th>í˜„ì¬ ì‹œê°„</th>
                        <td>{{ kimchi_data.current_time }}</td>
                    </tr>
                    <tr>
                        <th>USD/KRW</th>
                        <td>{{ kimchi_data.now_usd_krw |floatformat:2 |intcomma }}</td>
                    </tr>
                    <tr>
                        <th>BTC ê°€ê²© (KRW)</th>
                        <td>{{ kimchi_data.now_upbit_price |floatformat:2 |intcomma }}</td>
                    </tr>
                    <tr>
                        <th>BTC ê°€ê²© (USDT)</th>
                        <td>{{ kimchi_data.now_bitget_price |floatformat:2 |intcomma }}</td>
                    </tr>
                    <tr>
                        <th>BTC ê¹€í”„ (%)</th>
                        <td class="{% if kimchi_data.kp|to_float >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if kimchi_data.kp|to_float >= 0 %}+{% endif %}{{ kimchi_data.kp |floatformat:2 }}
                        </td>
                    </tr>
                </table>
            </p>
            <div class="investment-calendar-container my-4">
                <h3>ê²½ì œ ìº˜ë¦°ë”</h3>
                <iframe src="https://sslecal2.investing.com?borderColor=%2310b316&columns=exc_flags,exc_currency,exc_importance,exc_actual,exc_forecast,exc_previous&features=datepicker,timezone&countries=5,4,72,14,35,37,6,122,11,39&calType=week&timeZone=88&lang=18" width="650" height="300" frameborder="0" allowtransparency="true" marginwidth="0" marginheight="0"></iframe>
                <div class="poweredBy" style="font-family: Arial, Helvetica, sans-serif;">
                    <span style="font-size: 11px;color: #333333;text-decoration: none;">ì™¸í™˜ í¬í„¸ <a href="https://kr.Investing.com/" rel="nofollow" target="_blank" style="font-size: 11px;color: #06529D; font-weight: bold;" class="underline_link">Investing.com í•œêµ­ì–´</a>.</span>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <h3>ì»¤ë®¤ë‹ˆí‹° ê²Œì‹œíŒ</h3>
            <hr>
            <small>ê³µë¶€ë¥¼ ìœ„í•´ ë” ë‹¤ì–‘í•œ ì»¤ë®¤ë‹ˆí‹°ë„ ì°¸ê³ í•´ë³´ì„¸ìš”</small>
            <div class="btn-group mb-3 d-inline-block" role="group" aria-label="Platform Toggle">
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coinpickle.png' %}" alt="coinpickle Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://web.coinpickle.net/">coinpickle</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coinpan.png' %}" alt="coinpan Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://coinpan.com/">coinpan</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coinglass.png' %}" alt="coinglass Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://www.coinglass.com/LongShortRatio">coinglass</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coinness.png' %}" alt="coinness Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://coinness.com/community/lounge?category=8">coinness</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coinsect.png' %}" alt="coinsect Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://coinsect.io/">coinsect</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'sigbtc.png' %}" alt="sigbtc Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://sigbtc.pro/derivatives">sigbtc</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'kucoin_learn.png' %}" alt="kucoin Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://www.kucoin.com/ko/learn">ì¿ ì½”ì¸ êµìœ¡</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'mexc.png' %}" alt="MEXC Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://www.mexc.com/ko-KR/learn">MEXC íŠœí† ë¦¬ì–¼</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'binance_academy.png' %}" alt="binance academy Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://academy.binance.com/en/courses/all">Binance ì•„ì¹´ë°ë¯¸</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'coingecko.png' %}" alt="coingecko Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://www.coingecko.com/">CoinGecko</a>
                </button>
            </div>
            <br>
            <small>ë” ë§ì€ ì •ë³´ë¥¼ ìœ„í•´ í…”ë ˆê·¸ë¨ ì»¤ë®¤ë‹ˆí‹°ë„ ì°¸ê³ í•´ë³´ì„¸ìš”</small>
            <div class="btn-group mb-3 d-inline-block" role="group" aria-label="Platform Toggle">
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'telegram.png' %}" alt="byun Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://t.me/whaleliq">ì‹¤ì‹œê°„ ê³ ë˜ ì²­ì‚° ë‚´ì—­</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'telegram.png' %}" alt="whalealert Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://t.me/whalealertkorean">ì‹¤ì‹œê°„ ê³ ë˜ ì…ì¶œê¸ˆ ì•ŒëŒ</a>
                </button>
                <button type="button" class="btn btn-outline-secondary btn-sm">
                    <img src="{% static 'telegram.png' %}" alt="goldenstick Icon" style="height: 30px; margin-right: 5px;">
                    <a href="https://t.me/GDSTofficial">ê³¨ë“ ìŠ¤í‹±</a>
                </button>
            </div>
            <br>
            <!-- add search bar -->
            <div class="search-container">
                <form action="{% url 'aiphabtc:search_results' %}" method="get" class="row gx-2">
                    <div class="col">
                        <input class="form-control form-control-lg" type="search" placeholder="Search" aria-label="Search" name="q">
                    </div>
                    <div class="col-auto">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit">í¬ìŠ¤íŠ¸ ê²€ìƒ‰</button>
                    </div>
                </form>
            </div>
            <br>
            <div class="row">
                {% for board, posts in board_posts.items %}
                <div class="col-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5>
                                {% if board.name == 'free_board' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'free_board' %}">ììœ ê²Œì‹œíŒ</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ììœ ë¡­ê²Œ ì•„ë¬´ ì£¼ì œì— ëŒ€í•œ ê¸€ì„ ì‘ì„±í•´ì£¼ì„¸ìš”">[?]</span>
                                {% elif board.name == 'AI' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'AI' %}">ì¸ê³µì§€ëŠ¥</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ì¸ê³µì§€ëŠ¥ê³¼ ì–´ë–»ê²Œ ë¨¸ì‹ ëŸ¬ë‹, ë”¥ëŸ¬ë‹ì„ ì½”ì¸ íŠ¸ë ˆì´ë”©ì— ì ‘ëª©ì‹œí‚¬ ìˆ˜ ìˆëŠ”ì§€ì— ê´€í•œ ì •ë³´ê¸€ì„ ê³µìœ í•˜ëŠ” ê³³ì…ë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'general_qa' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'general_qa' %}">ì§ˆë¬¸ê³¼ ë‹µë³€</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ì•”í˜¸í™”í ì‹œì¥ì— ê´€ë ¨ëœ ì§ˆë¬¸ê³¼ ë‹µë³€ì„ í•´ì£¼ì‹œë©´ ë©ë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'trading' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'trading' %}">íŠ¸ë ˆì´ë”©</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ì•”í˜¸í™”í íŠ¸ë ˆì´ë”©ì— ê´€ë ¨ëœ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ê³³ì…ë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'perceptive_board' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'perceptive_board' %}">ê´€ì ê³µìœ  ê²Œì‹œíŒ</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ë¹„íŠ¸ì½”ì¸ ë° ì—…ë¹„íŠ¸ì— ìƒì¥ëœ ì•ŒíŠ¸ì½”ì¸ì— ëŒ€í•œ ê´€ì ì„ ì œê³µí•´ì£¼ê³  í•´ë‹¹ ê´€ì ì´ ë§ëŠ”ì§€ í‹€ë ¸ëŠ”ì§€ì— ë”°ë¼ ì¶”ê°€ í¬ì¸íŠ¸ ë³´ìƒì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'blockchain' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'blockchain' %}">ë¸”ë¡ì²´ì¸</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ë¸”ë¡ì²´ì¸ ê¸°ìˆ ì— ê´€ë ¨ëœ ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ê³³ì…ë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'economics' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'economics' %}">ê²½ì œ ë° ì‹œí™©</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ìµœê·¼ ê²½ì œì™€ ì‹œí™©ì´ ì–´ë–»ê²Œ ë¹„íŠ¸ì½”ì¸ê³¼ ì•”í˜¸í™”íì— ì˜í–¥ì„ ë¯¸ì¹ ì§€ì— ëŒ€í•´ ë…¼ì˜í•˜ê³  ê²½ì œ ê³µë¶€ì™€ ì •ë³´ê³µìœ ë¥¼ í•˜ëŠ” ê³³ì…ë‹ˆë‹¤">[?]</span>
                                {% elif board.name == 'creator_reviews' %}
                                <a href="{% url 'aiphabtc:board_filtered' 'creator_reviews' %}">ë°©ì†¡ê³¼ ì±… ë¦¬ë·°</a>
                                <span style="color: black; cursor: help;" data-bs-toggle="tooltip" data-bs-placement="top" title="ì½”ì¸ ë°©ì†¡ í¬ë¦¬ì—ì´í„°ì™€ ê´€ë ¨ ì„œì ì— ê´€í•œ ë¦¬ë·° ë° ì •ë³´ë¥¼ ê³µìœ í•˜ëŠ” ê³³ì…ë‹ˆë‹¤">[?]</span>
                                {% else %}
                                {{ board.name }}
                                {% endif %}
                            </h5>
                        </div>
                        <ul class="list-group list-group-flush">
                            {% for post in posts %}
                            <li class="list-group-item">
                                <a href="{% url 'aiphabtc:detail' post.id %}">
                                    {{ post.subject }}
                                </a>
                                <span class="badge bg-info float-end">{{ post.create_date|date:"Y-m-d" }}</span>
                            </li>
                            {% empty %}
                            <li class="list-group-item">No posts yet</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                {% endfor %}
            </div>
            <div>
                <strong>ë¹„íŠ¸ì½”ì¸ì— ëŒ€í•´ì„œ ì–´ë–»ê²Œ ìƒê°í•˜ì‹œë‚˜ìš”?</strong>
                <div class="voting-container">
                    <form id="sentimentVoteForm" action="{% url 'aiphabtc:submit_sentiment_vote' %}" method="post">
                        {% csrf_token %}
                        {% for option in sentiment_voting_options %}
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="sentimentVoteOption" id="sentimentVoteOption{{ option.id }}" value="{{ option.id }}">
                            <label class="form-check-label" for="sentimentVoteOption{{ option.id }}">
                                {{ option.name }}
                            </label>
                        </div>
                        {% endfor %}
                        <button type="submit" class="btn btn-primary btn-block">Submit Vote</button>
                    </form>
                </div>
                <button class="btn btn-info mt-3" type="button" data-toggle="collapse" data-target="#sentimentResults" aria-expanded="false" aria-controls="sentimentResults">
                    ìœ ì € ëˆ„ì  íˆ¬í‘œ ê²°ê³¼ ë³´ê¸° (%)
                </button>
                <div class="collapse" id="sentimentResults">
                    <div class="card card-body">
                        <canvas id="sentimentPieChart"></canvas> <!-- Canvas for Chart.js -->
                    </div>
                </div>
            </div>
            <hr>
            <h3>ë¨¸ì‹ ëŸ¬ë‹ ë¹„íŠ¸ì½”ì¸ ê°€ê²© ì˜ˆì¸¡ ì§€í‘œ</h3>
            <p>ì—…ë¹„íŠ¸ ì°¨íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ê°€ë²¼ìš´ ë¨¸ì‹ ëŸ¬ë‹ ì˜ˆì¸¡ì„ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ì‹œê°„ëŒ€ë¥¼ í¬í•¨í•œ ë³´ë‹¤ <strong>ê°•ë ¥í•œ</strong> ë¨¸ì‹ ëŸ¬ë‹ ì§€í‘œì™€ íˆ¬ì ë´‡ì— ëŒ€í•´ì„œëŠ” ì•„ë˜ í˜ì´ì§€ë“¤ì„ ì°¸ì¡°í•´ ì£¼ì„¸ìš”!</p>
            <p><a href="#">â¡ï¸ì•ŒíŒŒë¹„íŠ¸ ì¸ê³µì§€ëŠ¥ ë° í†µê³„ê¸°ë°˜ ë¹„íŠ¸ì½”ì¸ íˆ¬ìë´‡ ì§€í‘œğŸ“ˆğŸ“ˆ (coming soon)</a></p>
            <p><a href="#">â¡ï¸ì•ŒíŒŒë¹„íŠ¸ ì¸ê³µì§€ëŠ¥ ê¸°ë°˜ ë¹„íŠ¸ì½”ì¸ íŒ¨í„´ë§¤ì¹­ ì§€í‘œğŸ“ˆğŸ“ˆ (coming soon)</a></p>
            <p>
                <h5>ë‹¨ê¸° ë°©í–¥ì„± ì˜ˆì¸¡ ì§€í‘œ</h5>
                <small>ì˜¤ëŠ˜ ì˜¤ì „ 9ì‹œ ì¢…ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ì¼ ì˜¤ì „ 9ì‹œ ì¢…ê°€ ë°©í–¥ì„±ì˜ í™•ë¥ ì„ ì˜ˆì¸¡í•©ë‹ˆë‹¤. íŠœë‹ì´ ë˜ì§€ ì•Šì€ ê°€ë²¼ìš´ ëª¨ë¸ì´ë‹ˆ ì°¸ê³ ë§Œ í•´ì£¼ì„¸ìš”. "ë‚´ë¦°ë‹¤" ë˜ëŠ” "ì˜¤ë¥¸ë‹¤" ìœ„ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ë©´ ëª¨ë¸ì´ ì˜ˆì¸¡í•œ ê°ê°ì˜ í™•ë¥ ì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
                <br>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">XGBoost ì˜ˆì¸¡</h5>
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ xgb_short|floatformat:2 }}%;" aria-valuenow="{{ xgb_short|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ë‚´ë¦°ë‹¤ {{ xgb_short|floatformat:2 }}%">ë‚´ë¦°ë‹¤</div>
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ xgb_long|floatformat:2 }}%;" aria-valuenow="{{ xgb_long|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ì˜¤ë¥¸ë‹¤ {{ xgb_long|floatformat:2 }}%">ì˜¤ë¥¸ë‹¤</div>
                    </div>
                </div>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">LightGBM ì˜ˆì¸¡</h5>
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ lgb_short|floatformat:2 }}%;" aria-valuenow="{{ lgb_short|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ë‚´ë¦°ë‹¤ {{ lgb_short|floatformat:2 }}%">ë‚´ë¦°ë‹¤</div>
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ lgb_long|floatformat:2 }}%;" aria-valuenow="{{ lgb_long|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ì˜¤ë¥¸ë‹¤ {{ lgb_long|floatformat:2 }}%">ì˜¤ë¥¸ë‹¤</div>
                    </div>
                </div>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">RandomForest ì˜ˆì¸¡</h5>
                    <div class="progress" style="height: 30px;">
                        <div class="progress-bar bg-danger" role="progressbar" style="width: {{ rf_short|floatformat:2 }}%;" aria-valuenow="{{ rf_short|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ë‚´ë¦°ë‹¤ {{ rf_short|floatformat:2 }}%">ë‚´ë¦°ë‹¤</div>
                        <div class="progress-bar bg-success" role="progressbar" style="width: {{ rf_long|floatformat:2 }}%;" aria-valuenow="{{ rf_long|floatformat:2 }}" aria-valuemin="0" aria-valuemax="100" title="ì˜¤ë¥¸ë‹¤ {{ rf_long|floatformat:2 }}%">ì˜¤ë¥¸ë‹¤</div>
                    </div>
                </div>
            </p>
            <p>
                <h5>ë‹¨ê¸° ì‹œê³„ì—´ ì˜ˆì¸¡ ì§€í‘œ</h5>
                <small>ì˜¤ëŠ˜ ì˜¤ì „ 9ì‹œ ì¢…ê°€ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ì¼ ì˜¤ì „ 9ì‹œ ì¢…ê°€ë¥¼ ì˜ˆì¸¡í•´ë´…ë‹ˆë‹¤.</small>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">ElasticNet íšŒê·€</h5>
                    <p>BTC-KRW ë‚´ì¼ ì¢…ê°€ ì˜ˆì¸¡ê°’: <strong>{{ elasticnet_prediction|floatformat:2|intcomma }} KRW</strong></p>
                    <p>ì˜ˆì¸¡í•œ ë³€í™”ìœ¨:
                        <strong class="{% if elasticnet_percentage_change >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if elasticnet_percentage_change >= 0 %}+{% endif %}{{ elasticnet_percentage_change|floatformat:2 }}%
                        </strong>
                    </p>
                </div>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">ARIMA</h5>
                    <p>BTC-KRW ë‚´ì¼ ì¢…ê°€ ì˜ˆì¸¡ê°’: <strong>{{ arima_prediction|floatformat:2|intcomma }} KRW</strong></p>
                    <p>ì˜ˆì¸¡í•œ ë³€í™”ìœ¨:
                        <strong class="{% if arima_percentage_change >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if arima_percentage_change >= 0 %}+{% endif %}{{ arima_percentage_change|floatformat:2 }}%
                        </strong>
                    </p>
                </div>
                <div class="my-4 p-3 bg-light rounded">
                    <h5 class="mb-3">ë‹¤ì¸µ í¼ì…‰íŠ¸ë¡ </h5>
                    <p>BTC-KRW ë‚´ì¼ ì¢…ê°€ ì˜ˆì¸¡ê°’: <strong>{{ mlp_prediction|floatformat:2|intcomma }} KRW</strong></p>
                    <p>ì˜ˆì¸¡í•œ ë³€í™”ìœ¨:
                        <strong class="{% if mlp_percentage_change >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {% if mlp_percentage_change >= 0 %}+{% endif %}{{ mlp_percentage_change|floatformat:2 }}%
                        </strong>
                    </p>
                </div>
            </p>
            <!-- add advertisement banners here -->
            <div class="row">
                <div class="col-md-6 advertisement-container">
                    <div class="ad-label"><strong>ê´‘ê³ </strong></div>
                    <a href="https://www.youtube.com/@Coin-Issue" target="_blank">
                        <img src="{% static 'coinissue_ad2.png' %}" class="img-fluid advertisement-image">
                    </a>
                </div>
                <div class="col-md-6 advertisement-container">
                    <div class="ad-label"><strong>ê´‘ê³ </strong></div>
                    <a href="http://quantylab.com/" target="_blank">
                        <img src="{% static 'quantylab_ad2.png' %}" class="img-fluid advertisement-image">
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="footer">
    <p>ìƒí˜¸ëª…: ì•ŒíŒŒë¹„íŠ¸ | ëŒ€í‘œ: ê¹€ë¯¼ì„ | ì•ŒíŒŒë¹„íŠ¸ëŠ” ì¸ê³µì§€ëŠ¥ ë° ë¹„íŠ¸ì½”ì¸ ì •ë³´ê³µìœ  í”Œë«í¼ì…ë‹ˆë‹¤. ë³¸ ì§€í‘œì™€ ë´‡ë“¤ì€ íˆ¬ì ê¶Œìœ ìš©ì´ ì•„ë‹™ë‹ˆë‹¤. íˆ¬ìëŠ” í•­ìƒ ë³¸ì¸ì´ ì‹ ì¤‘í•˜ê²Œ ê²°ì •í•´ì„œ í•˜ì‹œê¸¸ ë°”ëë‹ˆë‹¤.</p>
</div>
{% endblock %}


{% block javascript %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    fetchNewsAndSentiment();
    document.getElementById('fetchTechnicalAIResponse').addEventListener('click', function() {
        fetchTechnicalAIResponse();
    });

    // Handle the form submission
    document.querySelector('.voting-container form').addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent the default form submission
        const formData = new FormData(this); // 'this' refers to the form element

        fetch("{% url 'aiphabtc:submit_sentiment_vote' %}", {
            method: 'POST',
            credentials: 'include', // Needed for including cookies (CSRF token)
            body: formData,
            headers: {
                'X-Requested-With': 'XMLHttpRequest', // Indicates an AJAX request
            },
        })
        .then(response => response.json())
        .then(data => {
            // Display the success/error message
            alert(data.message); // For simplicity, using an alert
            // You might want to update the DOM instead of showing an alert
            updatePieChart(data);
        })
        .catch(error => console.error('Error:', error));
    });

    // Initialize the pie chart here to ensure the DOM is fully loaded
    // Moved the chart initialization to a separate function for clarity
    initializePieChart();
});

function fetchNewsAndSentiment() {
    // Show the loading indicator
    const loadingIndicator = document.querySelector('.loading-indicator');
    loadingIndicator.style.display = 'block'; // Show loading indicator

    fetch('{% url "aiphabtc:get_news_and_sentiment" %}')
    .then(response => response.json())
    .then(data => {
        // Hide the loading indicator
        loadingIndicator.style.display = "none"; // Hide loading indicator after fetching

        // Extract data from the response
        const { scraped_data, avg_sentiment_scores_percentage, sentiment_labels } = data;

        // Update the news section
        const newsContainer = document.querySelector('.news-table');
        newsContainer.innerHTML = ''; // Clear existing news
        scraped_data.forEach(item => {
            const newsRow = document.createElement('div');
            newsRow.className = 'news-row';
            newsRow.innerHTML = `
                <div class="news-cell title-cell" data-tooltip="${item.contents}">
                    <span class="news-title">${item.titles}</span>
                </div>
                <div class="news-cell datetime-cell">
                    <span class="news-datetime">${new Date(item.datetimes).toLocaleString()}</span>
                </div>
            `;
            newsContainer.appendChild(newsRow);
        });

        // Update the sentiment scores section
        const sentimentScoresContainer = document.querySelector('.sentiment-scores');
        sentimentScoresContainer.innerHTML = ''; // Clear existing scores
        avg_sentiment_scores_percentage.forEach((score, index) => {
            const sentimentScoreDiv = document.createElement('div');
            sentimentScoreDiv.className = 'sentiment-score';
            const sentimentBar = document.createElement('div');
            sentimentBar.className = 'sentiment-bar';
            sentimentBar.style.width = `${score}%`;
            const sentimentText = document.createElement('span');
            sentimentText.className = 'sentiment-text';
            sentimentText.style.color = 'black';
            sentimentText.innerText = `${score}%`;

            sentimentScoreDiv.innerHTML = `<span class="sentiment-label">${sentiment_labels[index]}:</span>`;
            sentimentScoreDiv.appendChild(sentimentBar);
            sentimentScoreDiv.appendChild(sentimentText);

            sentimentScoresContainer.appendChild(sentimentScoreDiv);
        });
    })
    .catch(error => {
        console.error('Error fetching news and sentiment:', error);
        // Hide the loading indicator even if there is an error
        loadingIndicator.style.display = "none";
    });
}

function fetchTechnicalAIResponse() {
    // Show the loading message
    document.getElementById('TechnicalLoading').style.display = 'block';
    document.getElementById('TechnicalAIResponse').innerHTML = ''; // Clear previous response

    // Make the AJAX request
    fetch('{% url "aiphabtc:fetch_gpt_analysis" %}')
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
    })
    .then(data => {
        // Hide the loading message
        document.getElementById('TechnicalLoading').style.display = 'none';

        // Update the DOM with the response
        document.getElementById('TechnicalAIResponse').innerHTML = data.chat_message;
    })
    .catch((error) => {
        console.error('Error:', error);
        document.getElementById('TechnicalLoading').style.display = 'none';
        document.getElementById('TechnicalAIResponse').innerHTML = 'Sorry, there was a problem fetching the analysis.';
    });
}

function initializePieChart() {
    // Assuming 'sns_data' and 'sentiment_data' are available and properly formatted
    var ctxSentiment = document.getElementById("sentimentPieChart").getContext("2d");
    // Ensure the data is correctly formatted and passed here
    var sentimentData = {
        datasets: [{
            data: {{ sentiment_data.data|safe }}, // Assuming sns_data.data is an array of numbers
            backgroundColor: [
                'darkgreen', // Dark Green
                'green',     // Green
                'red',       // Red
                'darkred',    // Dark Red
                'grey',      // Grey
            ],
        }],
        labels: {{ sentiment_data.labels|safe }}, // Assuming sentiment_data.labels is an array of strings
    };

    new Chart(ctxSentiment, {
        type: "pie",
        data: sentimentData,
        options: {
            responsive: true,
            maintainAspectRatio: false, // Adjusted for better responsiveness
        }
    });
}
</script>
{% endblock %}
